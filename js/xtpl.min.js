
(function(){function u(g,b){u[g.replace(/.+\//,"")]=b}function l(g){return u[g.replace(/.+\//,"")]}var t=window.console;t||(t={log:function(){}});t.time||(t.time=t.timeEnd=function(){});u("fs",{writeFileSync:function(){},readFileSync:function(g){if(!$.ajax)throw"require jQuery";g=$.ajax(g+"?r="+Math.random(),{async:!1,dataType:"text"});if(200!=g.status)throw"ENOENT";return g.responseText}});var K=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},E=["0","0","0"],Za={}.toString,
sa="".trim,ta=[].slice,$a=/^#/,ab=/^\s+/,bb=/\s+$/,cb=/[&<>"]/,db=/&/g,eb=/>/g,fb=/</g,gb=/"/g,da="undefined"!==typeof navigator?"log":"error",M="undefined"!==typeof t&&t[da]&&t,ua=/[\\'"\/\n\r\t\b\f<>]/g,hb={'"':'\\"',"\\":"\\\\","/":"\\/","\n":"\\n","\r":"\\r","\t":"\\t","\b":"\\b","\f":"\\f","'":"\\'","<":"\\u003C",">":"\\u003E"};void 0===Function.prototype.bind&&(Function.prototype.bind=function(g){var b=ta.call(arguments,1),d=this;return function(){return d.apply(g,b.concat(ta.call(arguments,
0)))}});var F={isClient:"undefined"!==typeof navigator,mods:{xclass:function(g){var b=[],d;for(d in g)g[d]&&b.push(d);return b.join(" ")}},shortTags:{area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1,space:1,enter:1},$:function(g){return"string"==typeof g?document.getElementById(g.replace($a,"")):g},sizeof:function(g){var b=0;if(g&&(F.isArray(g)||"object"==typeof g))"length"in g?b=g.length:F.each(g,function(){b++});return b},isArray:function(g){return"[object Array]"==
Za.call(g)},uid:function(){return K()+K()+"-"+K()+"-"+K()+"-"+K()+"-"+K()+K()+K()},nextUid:function(){for(var g=E.length,b;g--;){b=E[g].charCodeAt(0);if(57==b)return E[g]="A",E.join("");if(90==b)E[g]="0";else return E[g]=String.fromCharCode(b+1),E.join("")}E.unshift("0");return E.join("")},ns:function(g,b,d){b=b.split(".");F.each(b,function(a){g[a]||(g[a]={});g=g[a]});g[b.pop()]=d},escapeHTML:function(g){"string"===typeof g?cb.test(g)&&(~g.indexOf("&")&&(g=g.replace(db,"&amp;")),~g.indexOf("<")&&
(g=g.replace(fb,"&lt;")),~g.indexOf(">")&&(g=g.replace(eb,"&gt;")),~g.indexOf('"')&&(g=g.replace(gb,"&quot;"))):void 0===g&&(g="");return g},escapeJS:function(g){"string"===typeof g&&ua.test(g)?g=g.replace(ua,function(b){return hb[b]}):void 0===g&&(g="");return g},revertEntities:function(g){return g.replace(/&([a-z]+)/g,function(){return g})},throttle:function(g,b,d){function a(){b.apply(g,e)}function c(){h=new Date;f=null;b.apply(g,e)}var e,f,h=0;return function(){var b=new Date,g=d-(b-h);e=arguments;
0>=g?(clearTimeout(f),f=null,h=b,setTimeout(a,0)):f||(f=setTimeout(c,g))}},log:M&&"object"==typeof M[da]?Function.prototype.call.bind(M[da],M):function(){M&&M[da].apply(M,arguments)},exception:function(g,b,d){throw{message:g,line:b,file:d};},error:function(g,b,d){b="Error: "+(g.message||g)+" in "+(g.file||d)+" on line "+(g.line||b);g.stack&&(g.stack=g.stack.split("\n").slice(1,4).join("\n"),b+="\n"+g.stack);F.log(b);return b},keys:function(g){var b=[];Object.keys?b=Object.keys(g):F.each(g,function(d){b.push(d)});
return b},map:function(g,b,d){for(var a=[],c=0,e=g.length;c<e;c++)a.push(b.call(d,g[c],c,g));return a},each:function(g,b,d){if(g){var a=0,c=g.length;if(0<=c&&0 in g)for(;a<c;a++)b.call(d,g[a],a,g);else for(a in g)g.hasOwnProperty(a)&&b.call(d,g[a],a,g)}},filter:function(g,b,d){for(var a=0,c=g.length,e=[];a<c;a++)b.call(d,g[a],a)&&e.push(g[a]);return e},trim:sa?function(g){return sa.call(g)}:function(g){return String(g).replace(ab,"").replace(bb,"")},extend:function(g){g=g||{};F.each(arguments,function(b,
d){0<d&&F.each(b,function(a,b){g[b]=a})});return g},indexOf:function(g,b){if(g.indexOf)return g.indexOf(b);for(var d=g.length;d--;)if(g[d]===b)return d;return-1}};"undefined"!==typeof u?u("utils",F):module.exports=F;var wa=function(g,b,d,a){d=d.split(ib);a.gid=a.gid||q.gid++;return g.each(function(c,e){if(e)for(c=d[G];c--;)va(e,b,d[c],a)})},va=function(g,b,d,a){var c,e,f,h=g[la]=g[la]||q.gid++;H[h]||(H[h]={});H[h][d]||(H[h][d]=[]);f=H[h][d];c=ma;e=a.gid;var j;if(!(j=ma[a.gid]))j=function(b){b=b||
win.event;b.target||(b.target=b.srcElement||Q);3===b.target.nodeType&&(b.target=b.target.parentNode);b.currentTarget||(b.currentTarget=g);!b.relatedTarget&&b.fromElement&&(b.relatedTarget=b.fromElement===b.target?b.toElement:b.fromElement);b.stopPropagation||(b.stopPropagation=function(){this.cancelBubble=!0});b.preventDefault||(b.preventDefault=function(){this.returnValue=!1});if(!1===a.call(g,b))return b.preventDefault(),b.stopPropagation(),!1};c=c[e]=j;e=q.inArray(a,f);if(g[xa])g[b?xa:jb](d,c,
!1);else g[b?"attachEvent":"detachEvent"]("on"+d,c);b?~e||f.push(a):(~e||(f.splice(e,1),delete ma[a.gid]),~f.length&&delete H[h][d],q.isEmptyObject(H[h])&&delete H[h])},ya=function(g){var b=g.attributes.value;return!b||b.specified?g.value:g.text},za=function(g){for(var b=0,d=this[G];b<d;b++)g.call(this[b],b,this[b]);return this},q="undefined"!==typeof jQuery&&jQuery,Q="undefined"!==typeof navigator&&window.document,ib=/\s+/,la="jqbit"+(new Date).getTime(),G="length",Aa=!1,Ba=[],Ca=0,ma={},H={},xa=
"addEventListener",jb="removeEventListener";q||(q=function(g){if(!(this instanceof q))return new q(g);this[G]=0;if(g){if(g instanceof q)return g;if("string"===typeof g)if("#"==g.charAt(0))this[0]=Q.getElementById(g.substr(1)),this[G]=+!!this[0];else{g=Q.getElementsByTagName(g.replace("\\",""));for(var b=0,d=this[G]=g.length;b<d;b++)this[b]=g[b]}else"function"===typeof g?Aa?g(q):Ba.push(g):(this[0]=g,this[G]=1)}return this},q.gid=1,q.inArray=function(g,b){for(var d=b.length;d--;)if(b[d]===g)return d;
return-1},q.isEmptyObject=function(g){for(var b in g)return!1;return!0},q.attr=function(g,b,d){var a;g&&(b in g||!("getAttribute"in g)?void 0!==d?g[b]=d:a=g[b]:void 0!==d?g.setAttribute(b,d):a=g.getAttribute(b));return a},q.prop=function(g,b,d){var a;g&&(void 0!==d?g[b]=d:a=g[b]);return a},q.cleanData=function(g){for(var b=g[G];b--;){var d=g[b],a=H[d[la]],c=void 0,e=void 0,f=void 0;if(a)for(c in a){f=a[c];for(e=f.length;e--;)va(d,0,c,f[e])}}},q.prototype=q.fn={constructor:q,attr:function(g,b){var d=
this[0],a=0,c=this[G],e,f=this;if("string"==typeof g&&void 0===b)f=q.attr(d,g);else{d=g;if(void 0!==b){var h={};h[d]=b;g=h}else g=d;for(;a<c;a++)for(e in g)q.attr(this[a],e,g[e])}return f},prop:function(g,b){return void 0===b?this[0]&&this[0][g]:this.each(function(){this[g]=b})},data:function(g,b){if(void 0===b)return this.attr("data-"+g);this.attr("data-"+g,b);return this},each:za,val:function(g){var b;if(void 0===g){var d=this[0];if(d){if("SELECT"==d.nodeName){b="select-one"===d.type;var a=[],c=
d.options,e=c.length;if(0>d.selectedIndex)d=null;else{for(;e--;)d=c[e],d.selected&&!d.disabled&&a.push(ya(d));d=b?a[0]:a}}else d=d.value;b=d}}else b=this.each(function(a,b){if(/select/i.test(b.nodeName)){var c=g;if(null==c||c instanceof Array&&!c.length)b.selectedIndex=-1;c=[].concat(c);za.call(b.options,function(a,b){b.selected=-1<q.inArray(ya(b),c)})}else b.value=g});return b},bind:function(g,b){return wa(this,1,g,b)},unbind:function(g,b){return wa(this,0,g,b)},empty:function(){var g=this[G],b;
for(q.cleanData(this);g--;)for(b=this[g];b.hasChildNodes();)1==b.nodeType&&q.cleanData(b.getElementsByTagName("*")),b.removeChild(b.firstChild);return this}},Q&&function b(){var d=Q.body&&Q.body.firstChild;if(d){do if(1==d.nodeType){for(q.isReady=Aa=!0;d=Ba.shift();)d(q);return}while(d=d.nextSibling)}10>Ca&&setTimeout(b,50*++Ca)}());"function"==typeof u?u("jquery",q):module.exports=q;var x=l("./utils"),r=function(b,d,a,c){if(!(this instanceof r))return new r(b,d,a,c);if("number"===typeof b)switch(c=
a,a=d,d=b,d){case r.TEXT:b="<text>";break;case r.CDATA:b="<cdata>";break;case r.COMMENT:b="<comment>";break;case r.FRAGMENT:b="<fragment>"}else b=b.toLowerCase(),b.match(kb)&&(this.ns=RegExp.$1,b=RegExp.$2);this.name=b;this.nsname=(this.ns?this.ns+":":"")+b;this.type=d;this.value=a;this.attrs=c||{};this["short"]=!!lb[b];this.children=[]},kb=/^([^:]+):(.+)/,Da={ELEMENT:1,ATTR:2,TEXT:3,CDATA:4,COMMENT:8,FRAGMENT:11},lb=x.shortTags;r.prototype={constructor:r,is:function(b){return~(" "+this.name+" "+
this.nsname+" ").indexOf(" "+b+" ")},text:function(){return this.first().value},getRoot:function(){for(var b=this;b.parent;)b=b.parent;return b},getPath:function(){if(this.node)return this.node.getPath();var b=[];this.closest(function(d,a){if(!d.ns&&d.parent){for(var c=d.parent.children,e=0,f,h=0;f=c[e];e++){f.is("x:else")&&(h=0);if(f===d)break;f.ns||h++}b.push(h)}else if(0<a&&d.ns){if(d.binded||d.is("x:each"))return!0;if(d.is("x:each"))return b=-1,!0}});return b},first:function(){return this.children[0]},
last:function(){return this.children[this.children.length-1]},prev:function(b){var d=this.parent.index(this)-1,a=[],c=this.parent.children,e;if(b)for(;(e=c[d])&&b(e);d--)a.unshift(e);return b?a:c[d]},next:function(b){var d=this.parent.index(this)+1,a=[],c=this.parent.children,e;if(b)for(;(e=c[d])&&b(e);d++)a.push(e);return b?a:c[d]},prepend:function(b){this.append(b,!0)},append:function(b,d){if(x.isArray(b)){b=[].concat(b);for(var a=0,c=b.length;a<c;a++)this.append(b[a])}else b.parent&&b.parent!==
this&&b.parent.remove(b),b.parent=this,this.children[d?"unshift":"push"](b);return this},index:function(b){return x.indexOf(this.children,b)},remove:function(b){b=this.index(b);~b&&this.children.splice(b,1)},insertBefore:function(b,d){var a=this.index(d);b.parent=this;this.children.splice(a,0,b)},insertAfter:function(b,d){var a=this.index(d);b.parent=this;this.children.splice(a+1,0,b)},replaceWith:function(b){this.parent.insertBefore(b,this);this.parent.remove(this)},clear:function(){for(var b=this.children,
d=b.length;d--;)this.remove(b[d]);return this},closest:function(b){var d=this,a=0;do if("string"==typeof b&&d.is(b)||b instanceof Function&&b(d,a++))return d;while(d=d.parent)},find:function(b){var d=[],a=">"!=b.charAt(0);b=b.replace(">","");x.each(this.children,function e(f){(f.name==b||"*"===b)&&d.push(f);a&&x.each(f.children,e)});return d},attr:function(b,d){if(this.attrs[b])return this.attrs[b].value;this.exception('attribute "'+(d||b)+'" is missing')},attrVal:function(b,d){return this.attrAny(b)||
d},attrAny:function(b,d){var a;x.each(b.split(" "),function(b){a=a||this.attrs[b]},this);d&&!a&&this.attr(d);return a&&a.value},addAttr:function(b,d){return this.attrs[b]=d instanceof r?d:r(b,r.ATTR,d)},removeAttr:function(b){delete this.attrs[b]},clone:function(b){var d=r(this.type),a,c;for(a in this)c=this[a],~"number string boolean".indexOf(typeof c)&&(d[a]=c);x.extend(d,b);x.each(attrs,function(a,b){d.attrs[b]=r(b,r.ATTR,a)});return d},mirror:function(b){b=this.clone(b);b._name=this.name;return b},
exception:function(b){b='Tag "'+(this._name?this._name:(this.ns?this.ns+":":"")+this.name)+'": '+b;throw{message:b,line:this.line,file:this.file};},trace:function(b){b||t.log("~~~~");var d=(this.ns?this.ns+":":"")+this.name,a="<"+d;this.type==this.TEXT?t.log(b||"","<<"+this.value+">>"):(x.each(this.attrs,function(b,d){a+=" "+d+'="'+b.value+'"'}),t.log(b=b||"",a+(this.empty?"/>":">")),this.empty||(x.each(this.children,function(a){a.trace(b+"   ")}),t.log(b,"</"+d+">")))}};for(var na in Da)r[na]=r.prototype[na]=
Da[na];r.make=function(b,d){var a=isNaN(b)?r(b,r.ELEMENT):r(b);b===r.TEXT?a.value=d:"object"==typeof d?x.each(d,function(b,d){"_"==d?x.extend(a,b):"content"==d?a.append(r(r.TEXT,b)):"children"==d?x.each(b,function(b){a.append(b instanceof r?b:r.make(b[0],b[1]))}):a.addAttr(d,b)}):d&&a.append(r(r.TEXT,d));a.empty=!a.children.length;return a};"function"==typeof u?u("Node",r):module.exports=r;var mb=l("fs"),v=l("./Node"),R=l("./utils"),L=function(b){this._opts=b=R.extend({tags:!1,left:"<",right:">",
c_open:"\x3c!--",c_close:"--\x3e",trim:!0,file:"<unknown file>",line:0,entity:"undefined"!==typeof navigator},b);b.tags&&(this._opts.tags=b.tags=" "+b.tags+" ")},nb=function(b){var d=(b+"").split(""),a=0,c={};this.pos=function(){for(var b=a;b--&&"\n"!=d[b];);return a-b+1};this.line=function(){for(var b=1,c=a;c--;)"\n"==d[c]&&b++;return b};this.peek=function(b){return d[a+(b||0)]};this.lex=function(b){return d.slice(a,a+b).join("")};this.match=function(a){var b=this.lex(a.length)===a;this.lastMatch=
b?a:null;this.lastMatchLength=b?a.length:0;return b};this.next=function(b){"string"===typeof b&&(b=b.length);a+=b||1;return this};this.save=function(b){c[b]=a;return this};this.load=function(b){a=c[b];return this};this.length=function(){return d.length-a};this.getStr=function(){for(var a,b="",c=this.peek(),d=1;a=this.peek();)if(this.next(),b+=a,"\\"==a)d++;else{if(c==a&&!(d%2))return b.substring(1,b.length-1);d=0}};this.substr=function(b,c){return d.slice(b,c||a).join("")};this.extract=function(a,
b){this.save("extract");void 0!==b&&this.next(b);for(var c="",d;d=this.peek();){if(this.match(a))return this.next(a),c;c+=d;this.next()}this.load("extract");return null}},Fa=function(b){R.each(b.attrs,function(b){b.value=Ea(b.value)});b.type==v.TEXT&&(b.value=Ea(b.value));R.each(b.children,Fa)},Ea=function(b){return b?b.replace(/&(\w+);/g,function(b,a){return ob[a]||b}):b},pb=/['"]/,oa=/^[\s\r\n\t]+$/,qb=/^([$a-z][\da-z\s:>]|\/\w)$/i,Ga=/[a-z\d:-]/i,rb=R.shortTags,ob={amp:"&",apos:"'",quot:'"',lt:"<",
gt:">"};L.prototype={constructor:L,parse:function(b){return this.parseString(R.trim(mb.readFileSync(this._opts.file=b)))},parseString:function(b){var d,a="",c,e=this._opts,f=e.tags,h=e.left,j=e.right,k=e.c_open,p=e.c_close,B=h.length,n=v(v.FRAGMENT),r=[],m,q=e.file;n.file=q;n.line=0;b=new nb(b);a:for(;d=b.peek();){m=b.line();if(1==m&&b.match("<?"))b.extract("?>",2);else if(b.match(k))d=b.extract(p,b.lastMatchLength),null!==d&&(d=v(v.COMMENT,d),d.file=q,d.line=m,n.append(d));else if(b.match("<![CDATA["))d=
b.extract("]]\x3e",b.lastMatchLength),null!==d&&(d=v(v.CDATA,d),d.file=q,d.line=m,n.append(d));else if(b.match(h))if(qb.test(b.peek(B)+b.peek(B+1))){d="/"==b.next(h).peek()?(b.next(),!0):!1;c=b;var u=f,l=j,s,w=c;s=void 0;for(var t="";s=w.peek();)if(Ga.test(s))t+=s,w.next();else break;s=t;var t=void 0,z=w=!1,A={},x="",y=void 0;if(c.length()){c.save("attrs");u=!u||-1<u.indexOf(" "+s+" ");c:for(;t=c.peek();)if(u&&Ga.test(t))for(x="";t=c.peek();)if(c.match(l)||oa.test(t)){A[x]=v(x,v.ATTR);continue c}else if("="==
t){if(pb.test(c.peek(1)))y=c.next().getStr();else{for(y="";(t=c.next().peek())&&!oa.test(t)&&!c.match(l);)y+=t;y=""==y?void 0:y}A[x]=v(x,v.ATTR,y);continue c}else x+=t,c.next();else if(c.match(l)){z=!0;w="/"==c.peek(-1);c.next(l);break}else u||(x+=t),c.next();z?(c=u?v(s,v.ELEMENT,"",A):v(s,v.ELEMENT,"",x),c.closed=w):(c.load("attrs"),c=v(v.TEXT,s))}else c=v(v.TEXT,s);2==e.trim&&(a=R.trim(a));if((!e.trim||!oa.test(a))&&""!=a)l=v(v.TEXT,a),l.file=q,l.line=n.last()?n.last().line:n.line,/^\s*\n/.test(a)&&
l.line++,/\n\s*$/.test(a),l.value=a,n.append(l);a="";if(c.type==v.TEXT)n.append(c);else{if(c.opened=!d)r.push(c),n.append(c),n=c;if(c.closed=c.closed||d){d=r.pop();for(n=n.parent;rb[d.name]&&!d.is(c.name);)d.empty=!0,d.closed=!0,d=r.pop().append(d.children),n=d.parent;d.is(c.name)||d.exception("not closed")}c.empty=c.opened&&c.closed}}else{a+=d;b.next();continue a}else a+=d,b.next();0==b.length()&&""!=a&&n.append(v(v.TEXT,a));c||(c=n.children[n.children.length-1]);c&&!c.line&&(c.line=m,c.file=q)}n.type!=
v.FRAGMENT&&n.exception("not closed");e.entity&&Fa(n);return n}};L.parse=function(b,d){return(new L(d)).parse(b)};L.parseString=function(b,d){return(new L(d)).parseString(b)};"function"==typeof u?u("Parser",L):module.exports=L;var S=l("./jquery"),I=l("./utils"),C=function(){this._data=y?[]:""},sb=function(b,d){var a=d.fn,c=d.$el,e=d.extra.bind,f=d.extra.event,h=function(d){var f=d.currentTarget,h=f.value;try{!e&&"checkbox"==f.type?h=f.checked:~f.nodeName.indexOf("SELECT")&&(h=c.val()),a(d,h)}catch(B){}d.preventDefault();
!1!==d.$apply&&b.$apply()};d.extra.sel?c.delegate(d.extra.sel,f,h):c.bind(f,h);d=null},tb=function(b,d,a,c,e,f){var h=f.childNodes,j=0,k=document.createElement("div"),p=[],B=b.idx;a&&void 0!==a._&&(p._={});I.each(c,function(c,B){var m=h[j],l=a[B];void 0!==p._?(l=a._[a[j]],p[j]=B,p._[B]=c):p[j]=c;if(l!==c){if(a[B+1]===c){j++;a.splice(B+1,1);f.removeChild(m);ea(m,!0);fa(B+"-"+d.path,b._binds);return}l=b.xpath;fa(j+"-"+d.path,b._binds);b.idx=j;b.xpath=d.xpath;b._data=y?[]:"";b.onAdd=void 0===m;e(c,B);
b.xpath=l;l=Ha(b.toStr(),k);b.onAdd?f.appendChild(l):(ea(m,!0),Ia(m,l,f));b.onAdd=!1}j++});k=null;b.idx=B;for(c=h.length-1;c>=j;c--)ea(h[c],!0),fa(c+"-"+d.path,b._binds),f.removeChild(h[c]);return p},Ia=function(b,d,a){void 0===a&&(a=b.parentNode);a.insertBefore(d,b);a.removeChild(b)},ea=function(b,d){1===b.nodeType&&(!0===d&&S.cleanData([b]),S.cleanData(b.getElementsByTagName("*")))},fa=function(b,d,a){var c=d.length;for(b=RegExp("\\b"+("-"===b?"":b)+"$");c--;)d[c]!==a&&b.test(d[c].path)&&d.splice(c,
1)},ga=function(b,d){var a=b,c;if(b instanceof Array){c=b.length;for(a=[];c--;)a[c]=d?b[c]:ga(b[c])}else if(b instanceof Function)a=b;else if(b instanceof Object)for(c in a=[],a._={},b)b.hasOwnProperty(c)&&(d?(a.push(c),a._[c]=b):a[c]=ga(b[c]));return a},Ja=function(b,d){var a,c=!1,e=typeof d;if(typeof b!==e&&"object"===e)c=!0;else if("object"===e)for(a in d){if(d.hasOwnProperty(a)&&Ja(b[a],d[a])){c=!0;break}}else c=b!=d;return c},Ha=function(b,d){void 0===d&&(d=document.createElement("div"));/^<option/i.test(b)?
(d.innerHTML="<select>"+b+"</select>",d=d.firstChild):d.innerHTML=b;return d.firstChild},y=I.isClient&&(window.opera||/MSIE/.test(navigator.userAgent)),ub=I.escapeJS,Ka=I.escapeHTML,vb=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i;C.$=S;C.prototype={constructor:C,$:S,utils:I,error:function(b,d,a){I.error(b,d,a)},a:function(b,d){if(void 0===this._attrs)this._main=this._data,this._attr=b,this._attrs={},this._attrs[b]=this._data=
y?[]:"";else{this._attr!==b&&(this._attrs[this._attr]=this._data,this._data=this._attrs[b]);if(void 0===this._attrs[b]||1===d)this._attrs[b]=this._data=y?[]:"";this._attr=b}},attrs:function(b){var d=new C,a=this._attrs,c=this._attr,e;a[c]=this._data;this._data=this._main;for(c in a)d._data=a[c],d._blocks=this._blocks,e=d.end(),void 0!==b?b[c]=e:""!==e&&this.s(" "+c+'="'+e+'"');delete this._attr;delete this._attrs},w:function(b,d){"js"===d&&(b=ub(b));this.s(b)},v:y?function(b){this._data.push(Ka(b))}:
function(b){this._data+=Ka(b)},s:y?function(b){this._data.push(b)}:function(b){this._data+=b},each:function(b,d){if(b){var a=b.length,c=a,e=0,f=this.idx;if(void 0!==a&&0 in b)for(;c--;)this.idx=e++,d(b[a-c-1],a-c-1);else for(c in b)b.hasOwnProperty(c)&&(this.idx=e++,d(b[c],c));this.idx=f}},cycle:function(b,d,a){for(;b<=d;b++)a(b)},blockLabel:function(b,d){void 0===this._blocks&&(this._chunks=[],this._blocks=[],this._attrs=[]);var a=this._chunks.length;this._chunks[a]=this.toStr();this._blocks[a]=
b;this._attrs[a]=d;this._data=y?[]:""},setBlock:function(b,d){void 0===this._block&&(this._block={});this._block[b]=d},getBlock:function(b,d,a){b=this._block[b];if(void 0!==b){if(void 0===a)return a=new C,a._block=this._block,b(a,d),a.end();b(a,d)}else return""},end:function(){if(void 0!==this._blocks){for(var b=this._blocks,d=this._chunks,a=this._attrs,c=d.length-1,e=d[c]+this.getBlock(b[c],a[c]);c--;)e=d[c]+this.getBlock(b[c],a[c])+e;return e+this.toStr()}return this.toStr()},clear:function(){this._data=
y?[]:""},toStr:y?function(){return this._data.join("")}:function(){return this._data}};C.Bind=function(b,d,a){this._el=b.jquery?b[0]:b;this._fn=d;this._decl=a;this._data=y?[]:"";this._binds=[];this._idx=[];this.xpath=[];this.$apply=I.throttle(this,this.$apply,25)};var wb=C.Bind,La,Ma=function(){};Ma.prototype=C.prototype;La=new Ma;wb.prototype=La;I.extend(C.Bind.prototype,{xpush:function(b,d){void 0!==this.idx&&(b[b.length-1]=this.idx);d||(this._idx.push(this.idx),delete this.idx);this.xpath=b.concat(this.xpath)},
xpop:function(b,d){d||(this.idx=this._idx.pop());this.xpath.splice(0,b)},b:function(b,d,a,c){this.bind("expr",b,d,a,c)},bind:function(b,d,a,c,e){var f=[],h,j=a.length;this.xpush(d,"f"===e);this._binds.push({type:b,expr:a,prev:f,fn:c,path:this.xpath.join("-"),xpath:[].concat(this.xpath),extra:e,onAdd:this.isReady&&this.onAdd});"apply"==b&&this.xpop(d.length,!0);if(void 0!==c&&"event"!==b&&"declare"!==b){for(;j--;)try{f[j]=ga(h=a[j](),"each"==b)}catch(k){}"each"===b?this.each(h,c):"attr"!==b&&c.apply(this,
f)}"apply"!==b&&this.xpop(d.length,"f"===e);return this._binds[this._binds.length-1]},be:function(b,d,a,c,e){this.bind("event",b,[c],c,{sel:a,bind:e,event:d})},bd:function(b,d,a){this.bind("declare",b,d,a)},ba:function(b,d,a){var c=this,e={},f=function(){var b={},d,f,p=this.el;c._data=y?[]:"";a();c.attrs(b);for(d in b)f=b[d],e[d]!==f&&(vb.test(d)?p[d]=f==d:"class"==d?p.className=f:"style"==d&&p.style.cssText?p.style.cssText=f:"value"===d?p.value!=f&&(p.value=f):p.setAttribute(d,f));e=b};a();c.attrs();
0===d?c.bind("attr",b,[f]):c.bind("attr",b,[d],f)},setData:function(b){b.$bind=this;b.$apply=this.$apply;b.$fn=function(d){return function(){d.apply(window,arguments);b.$apply()}};S(this._el).empty().prop("innerHTML",this._html=this._fn(this,b));this.isReady=!1;this.$apply()},getHtml:function(){return this._html},$apply:function(){t.time("$apply");var b=this._binds,d=[],a,c,e,f,h,j,k,p,B=!1,n=0,l=0;for(this.isReady=!0;void 0!==(a=b[l]);l++){h=[];p=a.type;c=a.xpath;e=a.expr;f=a.prev;B=!1;a.idx=l;k=
a;if(void 0===k.el){for(var n=k,m=k.xpath,q=this._el,r=m.length;r--&&!(q=q.childNodes[m[r]],!q););n.el=q;k.$el=S(k.el);void 0===k.el&&t.log(k,"\u2014 not found!")}k=k.el;for(n=e.length;n--;){if("event"===p&&!a.extra.bind){B=!0;break}try{h[n]=j=e[n].call(a)}catch(s){t.log(e[n].toString()),I.error(s)}"each"===p?h[n]=tb(this,a,f[n],j,a.fn,a.el):Ja(f[n],j)&&(h[n]=ga(j),B=!0)}a.prev=h;e=this.xpath;this.xpath=c;if(B)if("declare"===p)a.inited?this._decl[a.fn].update&&this._decl[a.fn].update(a.el,h[0],f[0],
this):d.push(a);else if("event"===p)if(a.inited)try{a.$el.val(j)}catch(u){setTimeout(function(){this.val(j)}.bind(a.$el))}else d.push(a);else"expr"===p||"apply"===p?(ea(k,"apply"==p),fa(("apply"==p?"":"-")+a.path,b,"apply"===p&&a),this._data=y?[]:"",a.fn.apply(this,h),"apply"==p?(delete a.el,Ia(k,Ha(this.toStr()))):k.innerHTML=this.toStr()):"attr"==p&&a.fn();this.xpath=e}for(l=d.length;l--;)a=d[l],a.inited=!0,"declare"==a.type?this._decl[a.fn].init(a.el,a.prev[0],a.onAdd,this):(a.extra.bind?a.$el.val(a.prev[0]):
b.splice(a.idx,1),sb(this,a));t.timeEnd("$apply")}});"function"==typeof u?u("Buffer",C):module.exports=C;var Na=l("./Parser"),m=l("./Node"),w=l("./utils"),Oa=function(b){return~" :value :script ".indexOf(" :"+b.name+" ")||b.type==b.TEXT},Pa=function(b){return~" :space :text :enter ".indexOf(" :"+b.name+" ")||b.type==m.TEXT},N=function(b,d){if(b.length){var a=b[0].parent,c;c=a.children;var e=0;if(d||b.length!=c.length)if(!d&&w.each(c,function(a){e+=!a.is("x:bind-event")}),d||b.length!=e)c=m.make("x"),
a.insertBefore(c,b[0]),a=c.append(b);return a}},Qa=function(b,d){var a=w.filter(b.children,function(a){return!a.is("x:bind-event")});(d||1<a.length||b.first().is("<text>")||b.first().ns&&!b.first().is("x:apply"))&&N([].concat(b.children),!0)},O=function(b,d,a,c){if(d.bind||d.attrs.bind||c&&d.attrs[a]){var e=0,f=d.attrAny("bind "+a);d.removeAttr("bind");if(!b){d.addAttr(a,f);return}if(d.is("if")||d.is("else"))f="!!("+f+")";d.data=[f];d.binded=!0;c||(c=m.make("x:bind",{_:{data:[]}}),d.parent.insertBefore(c,
d),c.append(d));e=c.data.push(f)-1;b="__xbind"+e;"value"==d.name?(d.first().value=b,c.addAttr("mode","f")):d.addAttr(a,b);d[b]=f}return c},T=function(b,d,a,c,e,f){b&&d.parent.insertAfter(m.make("x:bind-event",{event:c||Ra[d.name+"[type="+d.attrVal("type","")+"]"]||Ra[d.name],sel:e,fn:f||a.value,_:{node:d}}),d);d.removeAttr(a.nsname)},Sa=/\{[*{](.*?)[*}]\}/g,xb=/^\s+(!?@)(\w+)\s*(\+?)=\s*(.+)/,s=[],pa={},Ra={input:"+input","input[type=radio]":"+change","input[type=checkbox]":"+change",select:"+change",
textarea:"+input"},aa={"if":function(b,d){var a=m.make("x:if",{_:{file:b.file,line:b.line},test:d.value});b.parent.insertBefore(a,b);a.append(b)},"tag-if":function(b,d,a){b.tagIf=b.attr(d.nsname);b._name=b.name;b.name="tag-if";b.bind=!0;a&&N([b]);O(a,b,d.nsname)},each:function(b,d){var a=d.value.match(/^\(?(\w+)(?:\s|,)\s*(\w+)?\)?\s*in\s*(.+)/);b.append(m.make("x:each",{bind:a[3],as:a[2]||a[1],key:a[2]?a[1]:"$index",children:b.children}))},"class":function(b,d){b.prepend(m.make("x:attr",{name:"class",
children:[["x:value",{_:{_name:b.name,file:b.file,line:b.line,error:'invalid expression in "x:class" attribute'},mod:"xclass",content:d.value}]]}))},"attr-getter":function(b,d){b.attrGetter=d.value},bind:function(b,d,a){var c=b.attrVal("type"),e=d.value;if("select"==b.name)T(a,b,d,"+change");else if("radio"==c)b.append(m.make("x:if",{test:b.attrVal("x:value")?b.attr("x:value")+"=="+e:JSON.stringify(b.attrVal("value"))+"=="+e,children:[["x:attr",{name:"checked",content:"checked"}]]})),T(a,b,d,"change"),
b.removeAttr("x:bind");else if(b.removeAttr("value"),b.append(m.make("x:attr",{name:"value",children:[["x:value",e]]})),!c||"text"==c)b.addAttr("type",c),T(a,b,d,"input")},value:function(b,d,a){"radio"==b.attrVal("type")&&(b.append(m.make("x:attr",{name:"value",children:[["x:value",d.value]]})),aa.bind(b,b.attrs["x:bind"],a))},checked:function(b,d,a){aa.disabled(b,d);T(a,b,d,"change")},disabled:function(b,d){var a=d.name;b.append(m.make("x:if",{test:d.value,children:[["x:attr",{name:a,content:a}]]}))},
delegate:function(b,d,a){w.each(d.value.split(/\n/g),function(c){if(c=w.trim(c)){var e=c.match(/\[([^\]]+)\]\s+(.+)\s+=>\s+(.+)/m);e?T(a,b,d,e[1],e[2],e[3]):b.exception('invalid expresion in "x:delegate" attribute: '+c)}})}};w.each("submit click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave".split(" "),function(b){aa[b]=function(d,a,c){T(c,d,a,b)}});s.push("include",function d(a){var c=a.attr("src"),e,f;"/"!==c.charAt(0)&&(c=a.file.substr(0,a.file.lastIndexOf("/"))+
"/"+c);f=c.replace(/[^\w_\d]/g,"");if(!pa[f])try{var h=Na.parse(c);e=h.find(">tpl")[0];e.attrs.name||e.addAttr("name",f);pa[f]=e.attrs.name.value;a.closest(function(a){if(a.is("tpl"))return a.append(h),!0});w.each(a.find("include"),function(a){d(a)})}catch(j){j=j.toString(),~j.indexOf("ENOENT")&&a.exception("no such file "+c)}a.attrs.src.value=pa[f]});s.push("tpl",function(d){w.each(d.find("elem"),function(a){a.name="match";a._name="elem";w.each(d.find(a.attr("name")),function(a){var d=a.first();
a.addAttr("name",a.name);a.name="apply";d&&(!d.is("x:data")&&!d.is("x:param"))&&a.append(m.make("x:param",{set:"content",children:[d]}))})})});s.push("<text>",function(d){var a=d.value,c=a,a=a.replace(Sa,function(a,c){return'<x:value bind="true">'+c+"</x:value>"}),a=w.map(a.split("\n"),function(a){return a=a.replace(xb,function(a,c,d,e,p){return'<x:attr name="'+d+'"'+(e?"":' mode="clear"')+"><x:value"+("@"==c?"":' output="text"')+">"+p.replace(/;+$/,"")+"</x:value></x:attr>"})}).join("\n");c!=a&&
(w.each(Na.parseString(a,{file:d.file,line:d.line}).children,function(a){(a.type!=a.TEXT||""!=w.trim(a.value))&&d.parent.insertBefore(a,d)}),d.parent.remove(d))});s.push("space,enter,text",function(d){var a=[].concat(d.prev(Pa),d,d.next(Pa)),c=d.parent,e=m(m.TEXT,"");c.insertBefore(e,a[0]);w.each(a,function(a,d){d=a.value;a.is("x:space")?d=" ":a.is("x:enter")?d="\n":a.is("x:text")&&(d=a.attrVal("value val"),a.first()&&(d=a.first().value));e.value+=d;c.remove(a)})});s.push("<element>",function(d,a){d.ns||
w.each(d.attrs,function(c){var e=c.value,f=c.name,h=0;if(c.ns){if(aa[f])aa[f](d,c,a);else this.processingDeclare(d,c,a);d.removeAttr(c.nsname)}else if(Sa.test(e)){var j=m.make("x:attr",{name:f});w.each(e.match(/\{\{[^}]*\}\}|\{[^{]+|[^{]+/g),function(a){if(""!==a){var c;"{{"===a.substr(0,2)?(c=m.make("x:value",a=a.slice(2,-2)),c.error="expression #"+ ++h+" >> "+a+' << in attribute "'+f+'"'):c=m(m.TEXT,a);c._name=d.name;c.line=d.line;c.file=d.file;j.append(c)}});d.removeAttr(f);d.prepend(j)}else e&&
(c.value=e.replace(/\{\{/g,"{").replace(/\}\}/g,"}"))},this)});s.push("tpl",function(d){d.attrs.name||d.addAttr("name","__x"+d.file.replace(/[^\w_\d]/g,""))});s.push("text",function(d){if(d.attrs.value){var a=d.attr("value");d.append(m(m.TEXT,a))}});s.push("tag",function(d,a){O(a,d,"select");d.ns=""});s.push("attr,attribute",function a(c){var e=c,f=!0;c.closest(function(h){if(h.ns)e=h;else{h.type==h.FRAGMENT&&(f=!1,h=h.parent);var j=c.attr("name"),k=h.attrs[j],p=h.attrs.__x;p||(h.addAttr("__x",p=
m(m.FRAGMENT)),p.append(m(m.FRAGMENT)));k?(h.removeAttr(j),k.ns="x",k.name="attr",k.type=c.ELEMENT,k.addAttr("name",j),k.append(m(m.TEXT,k.value)),p.children[0].append(k)):p["__x"+j]||(k=m.make("x:attr",{name:j}),p.children[0].append(k),p["__x"+j]=!0);f&&(p.parent=h,p.append(e),w.each(["attr","attributes"],function(f){w.each(e.find(f),function(e){e!==c&&a(e)})}));return!0}})});s.push("value",function(a,c){var e=a.attrVal("bind"),f,h;if(h=c)h=a.closest("each"),h=!(h&&!h.binded&&!h.attrs.bind);if((c=
h)&&"true"==e)if(a.addAttr("bind",a.first().value),f=a.parent.closest(function(a){return a.ns||a.is("tag")}),!f||!f.is("x:bind"))f=[].concat(a.prev(Oa),a,a.next(Oa)),e=N(f),f=m.make("x:bind",{_:{data:[]}}).append(e.children),e.append(f);O(c,a,"bind",f)});s.push("switch",function(a,c){c&&N([a]);O(c,a,"select")});s.push("get",function(a){a.children.length&&(a.attrs.context?a.exception('dual use of context in "attribute" and node "value"'):(a.addAttr("context",a.children[0].value),a.clear()))});s.push("each,for",
function(a,c){var e=a.attrVal("bind");e&&(a.binded=!0,a.addAttr("data",e),c?(N([a]),Qa(a)):a.removeAttr("bind"));a.attrs.iterate&&a.addAttr("data",a.attr("iterate"));a.attrs.index&&a.addAttr("key",a.attrVal("index"));a.attrs.value&&a.addAttr("as",a.attrVal("value"))});s.push("tag-if",function(a){a.ns=""});s.push("doctype",function(a){a.clear()});s.push("apply",function(a,c){var e=a.children.length;if(1==e&&a.first().is("<text>"))a.addAttr("data",a.first().value),a.clear();else if(0<e){var f=a.find(">data")[0],
h=a.find(">param");f&&(f.attrs.bind&&a.addAttr("bind",f.attrVal("bind")),a.addAttr("data",f.text()),a.remove(f));e-!!f-h.length&&a.exception("this tag can contain only <x:data/> or <x:param/>")}a.attrAny("name select")||a.exception('must be defined "name" or "select" attrbiute');"true"===a.attrVal("bind")&&a.addAttr("bind",a.attrVal("data"));c&&N([a]);if(e=O(c,a,"data"))e.addAttr("type","apply"),e.ns=""});s.push("data",function(a){var c=a.parent;c.is("apply")?1<c.find(">data").length&&a.exception("must be only one tag"):
a.exception("parent must be <x:apply/>, now: <"+c.nsname+"/>")});s.push("param",function(a,c){if(a.ns){var e=a.parent,f=e.is("x:apply");!f&&!e.closest("match")&&a.exception("parent must be <x:apply/> or <x:match/>, now: <"+e.nsname+"/>");a.attrs.get&&f&&a.exception('"get" attribute may be defined only in <x:match/>');a.attrs.set&&!f&&a.exception('"set" attribute may be defined only in <x:apply/>');a.attr(f?"set":"get");a.binded=!0;c&&(f&&!a.closest("attr"))&&Qa(a)}});s.push("match",function(a){var c=
a.closest("tpl");a=c.find("match");var e={};w.each(a,function(a){var c=a.attr("name")+a.attrVal("mode",""),j=e[c];j||(j=m.make("x:match",{name:c,children:[["x:choose",{children:[["x:when",{test:!1}],["x:otherwise"]]}]]}));a.attrs.test?(a.name="when",j.first().append(a,!0)):(a.name="<dummy>",j.first().find(">otherwise")[0].clear().append(a));e[c]=j});w.each(e,function(a){a.binded=!0;c.append(a,!0)})});s.push("if",function(a,c){c&&N([a]);var e=O(c,a,"test");e&&w.each(a.find(">else"),function(a){O(c,
a,"if",e)})});"function"==typeof u?u("pre",s):module.exports=s;l("./Parser");l("./Node");var ba=l("./utils"),U=function(a,c,e){var f=(e=e.xpath)&&e.length;return a&&f?"__buf."+(c?"xpush("+D(e)+");":"xpop("+f+");"):""},yb=1,V=[],ha=[],ia=[],ca=[],ja=[],D=JSON.stringify,Ta,P=function(a,c,e){a="try{"+a+"}catch(e){";c._file&&c._line&&(a+="__xerr("+(c._err?D(c._err):"e")+","+c._file+","+c._line+");");return a+(e||"")+"}\n"},z=function(a,c){var e="",f=0;a=a.replace(/([\$@&])([\w-]+)/g,function(a,j,k){a=
c[k];"@"==j?(e+="__xval"+f+"=0;"+P("__xval"+f+"="+a,c),a="__xval"+f,f++):"$"==j&&(a=D(a));return a});return e+a},W={dummy:{skip:!0},"<dummy>":{},"<comment>":{skip:!0},"<fragment>":{skip:!0},include:{args:["src","context?"],expr:["context"],"short":!0,code:function(a){return W["tpl-call"].code({name:a.src,data:a.context})}},doctype:{ns:!0,code:'__buf.s("<!DOCTYPE html>");'},comment:{code:{open:'__buf.s("\x3c!--");',close:'__buf.s("--\x3e");'}},tpl:{args:{name:0,ctrl:0,"context-name":function(a){return a.attrVal("context-name context_name",
"")}},expr:["data"],vars:["context-name","name"],alias:["template"],code:{open:function(a){ca.push(a.name);ja.push(a["context-name"]=a["context-name"]||"ctx");return z("function _&name(__buf,&context-name,__xfetch){"+(1==ca.length?Ta:"")+(a.ctrl?"if(__buf.ctrl!==void 0 && __buf.ctrl[$ctrl]!==void 0)__buf.ctrl[$ctrl](&context-name);":""),a)},close:function(a){ca.shift();ja.shift();return z(" if(__xfetch===void 0)return __buf.end();}",a)}}},"tpl-call":{args:["name?","data?"],vars:["name"],expr:["data"],
code:function(a){a.name=a.name||ca[ca.length-1];a.data=a.data||ja[ja.length-1];return z('typeof _&name !== "undefined" && _&name(__buf,@data);',a)}},text:{skip:!0,code:function(a){return"__buf.s("+D(a)+");"}},script:{ns:!0,args:["code"],expr:["code"],valid:function(a){a.addAttr("code",a.first().value);a.clear()},code:function(a){return P(a.code,a)}},enter:{"short":!0,replace:"\n"},space:{"short":!0,replace:" "},"if":{args:["test"],expr:["test"],code:{open:function(a){V.push(1);return z("if(@test){",
a)},close:function(){return Array(V.pop()+1).join("}")}}},"else":{args:["if?"],expr:["if"],"short":!0,parent:"if",valid:function(a){for(var c=a.parent,e=c.index(a),c=c.children,f;e--;)f=c[e],f.is("else")&&!f.attrAny("if")&&a.exception(a.attrAny("if")?'<x:else if="..."/> after <x:else/>':"duplicate")},code:{open:function(a){V[V.length-1]+=+!!a["if"];return"}else{"+z(a["if"]?"if(@if){":"",a)}}},choose:{code:{open:function(){ia.push(1)},close:function(){return Array(ia.pop()).join("}")}}},when:{args:["test"],
expr:["test"],parent:"choose",code:{open:function(a){ia[ia.length-1]++;return z("if(@test){",a)},close:"}else{"}},otherwise:{parent:"choose"},"switch":{args:["select"],code:{open:function(a){return z("switch(@select){",a)},close:"}"}},"case":{args:["test"],expr:["test"],parent:"switch",code:{open:function(a){return"case "+a.test+":"},close:"break;"}},"default":{parent:"switch",valid:function(a){a.parent.children[a.parent.index(a)+1]&&a.exception("must be lastChild")},code:{open:"default:",close:"break;"}},
"exec-once":{code:{open:function(a){a="__x"+yb++;return"__buf."+a+"!==1&&(function(){__buf."+a+"=1;"},close:"})();"}},bind:{empty:!1,args:{type:0,data:function(a){var c=a.data;c||(c=[a.attr("data")]);return c},xpath:1,mode:0},skip:function(a){return-1==a.xpath},code:{open:function(a){var c=[],e=[],f;ba.each(a.data,function(a,f){e.push("__xbind"+f);c.push("function(){return "+a+"}")});f=D(a.xpath)+",["+c.join(",")+"],function("+e.join(",")+"){var __buf=this;";return"__buf."+(a.type?"bind("+D(a.type)+
",":"b(")+f},close:function(a){return"}"+(a.mode?","+D(a.mode):"")+");\n"}}},"bind-event":{args:["xpath","event","sel","fn"],expr:["fn"],code:function(a){var c=a.event,e=a.fn,f="__buf.be($xpath,$event,"+D(a.sel||0);/\+?(input|change|select)/.test(c)?(f+="+"!=c.charAt(0)?",function(e,__xval){"+e+"=__xval});":",function(e,__xval){if(__xval!==void 0)"+e+"=__xval;return "+e+"},true);",a.event=c.replace("+",""),f=z(f,a)):(/^[^=]+$/.test(e)&&(e=e.replace(/(\w)(?:\(([^)]*)\)|);?$/,function(a,c,e){return c+
"("+(e||"")+(e?",":"")+"evt);"}).replace("$el","jQuery(evt.currentTarget)")),f=z(f,a)+",function(evt){"+e+(/\$\$/.test(e)?";evt.$apply=false;":"")+"});");return f}},"bind-declare":{args:["xpath","name","data?"],expr:["data"],code:function(a){return z("__buf.bd($xpath,[function(){return &data}],$name);\n",a)}},value:{args:{value:function(a){return a.value||a.children.shift().value},output:0,mod:0},expr:["value"],empty:!1,valid:function(a){var c=[a.TEXT,a.CDATA];ba.filter(a.children,function(a){return!~ba.indexOf(c,
a.type)}).length&&a.exception("can contain, only text or CDATA")},code:{open:function(a){var c=a.value;a.mod&&(c='__utils.mods["'+a.mod+'"]('+c+")");a.output&&(c+=',"'+a.output+'"');return P("__buf."+(a.output?"w":"v")+"("+c+")",a)}}},each:{args:["data","key?","as?","bind?","xpath?"],vars:["key","as"],expr:["data"],alias:["foreach"],code:{open:function(a,c){var e=a.as?a.as:a.key?"___":"";a.key&&(e+=","+a.key);return z(U(c,1,a)+(a.bind?'__buf.bind("each",[],[function(){return &data}]':"__buf.each(@data"),
a)+(",function("+e+"){")},close:function(a,c){return"});"+U(c,0,a)}}},"for":{args:["data?","key?","as?","from?","to?"],expr:["data"],vars:["key","as"],valid:function(a,c){c.data||(/^-?\d+$/.test(a.attr("from"))?/^-?\d+$/.test(a.attr("to"))?1*a.attr("to")<1*a.attr("from")&&a.exception('"to" less "from" attribute'):a.exception('"to" attribute must be number'):a.exception('"form" attribute must be number'))},code:{open:function(a){return a.data?W.each.code.open(a):z("__buf.cycle(&from, &to, function ("+
(a.key||"")+"){",a)},close:"});"}},attrs:{skip:!0,args:["xpath","getter"],alias:["attributes"],code:{open:function(a,c){W.attr.code._key=0;if("0"!==a.getter)return z(c?"__buf.ba($xpath,"+(a.getter?"function(){return &getter;}":0)+",function(){":"",a)},close:function(a,c){return"0"!==a.getter&&c?"});":"__buf.attrs();"}}},attr:{args:["name","mode?"],alias:["attribute"],code:function(a){var c=a.name;a="clear"==a.mode;if(this._key!==c+a)return"__buf.a("+D(c)+(a?",1":"")+");\n"}},get:{args:["name?","select?",
"context?"],expr:["select","context"],valid:function(a,c){!c.name&&!c.select&&a.exception('"name" or "select" attribute, must be defined');W.value.valid(a)},code:function(a){return z("__buf.blockLabel("+(a.name?"$name":"@select")+(a.context?",@context":"")+");\n",a)}},set:{args:["name","test?","context-name?"],expr:["test"],vars:["context-name"],code:{open:function(a){a.context=a["context-name"]||"params";return(a.test?z("if(@test)",a):"")+z("__buf.setBlock($name,function(__buf,&context){",a)},close:"});"}},
tag:{elem:!0,args:["select"],expr:["select"],code:{open:function(a){return"close"==a?'__buf.s(__xshort[__xtag[__xtag.length-1]]?"/>":">");':P("__xval="+a.select+';if(!__xval||typeof __xval!="string")throw"Element name must be a string, now \\""+__xval+"\\"";',a,'__xval="div";')+'__xtag.push(__xval); __buf.s("<"+__xval);'},close:function(){return'__xval=__xtag.pop();if(!__xshort[__xval])__buf.s("</"+__xval+">");'}}},"tag-if":{elem:!0,args:{test:function(a){return a.tagIf},name:function(a){return a._name}},
expr:["test"],code:{open:function(a){var c=a.name||ha[ha.length-1];if("close"==a)return'__buf.s("'+(ba.shortTags[c]?"/>":">")+'");}';ha.push(c);return P("__xval="+a.test,a,"__xval=0;")+'__xtagIF.push(__xval);if(__xval){__buf.s("<'+c+'");'},close:function(){var a=ha.pop();return"__xval=__xtagIF.pop();"+(ba.shortTags[a]?"":'if(__xval){__buf.s("</'+a+'>")}')}}},match:{args:["name"],code:{open:function(a){return z("__xthis[$name]=function(__buf,$,__xparams){",a)},close:"};"}},apply:{args:"name? select? mode? data? select-mode? xpath".split(" "),
expr:["data","select","select-mode"],code:{open:"__xparams={};",close:function(a,c){var e=a.select?P("__xval="+a.select+";",a):"__xval=$name;";if(a.mode||a["select-mode"])e+=a.mode?"__xval+=$mode;":P("__xval+="+a["select-mode"],a);return z(U(c,1,a)+(e+'typeof __xthis[__xval]==="function"&& __xthis[__xval](__buf,@data,__xparams);')+U(c,0,a),a)}}},param:{ns:!0,args:["get?","set?","xpath"],code:{open:function(a,c){var e="__xparams["+D(a.set||a.get)+"]";return e=a.set?e+"=function(__buf){":U(c,1,a)+e+
"!==void 0 && "+e+"(__buf);"+U(c,0,a)},close:function(a){return a.set?"};":""}}},__meta:function(a){Ta='"use strict";\nvar __xthis=this,GLOBAL=this,__xpath,__xval,__xval0,__xval1,__xval2,__xattrs,__xparams,__xtag=[],__xtagIF=[],__utils=__buf.utils,__xshort=__utils.shortTags,__xfiles='+D(a.files)+",__xerr=function(m,u,l){__utils.error(m,__xfiles[u],l)};"},__build:function(a){a=a.replace(/"\);__buf\.w\("/g,"").replace(/"\);__buf\.s\("/g,"");~a.indexOf("compile.fail")||l("fs").writeFileSync("out.js",
a);return(new Function("return "+a))()}};"function"==typeof u?u("tags",W):module.exports=W;var zb=l("./Parser"),Ua=l("./Node"),A=l("./utils"),Va=function(a,c,e){e="string"==typeof e?' in "'+e+'" attribute':"";c=c||a.value;try{try{new Function(c)}catch(f){try{new Function('"use strict";\n('+c+")")}catch(h){throw f;}}}catch(j){a.error?a.exception(a.error+"\n"+j.toString()):a.exception("invalid expression"+(e||"")+"\n>> "+c+" <<\n"+j.toString())}return c},Wa={_pre:[],_tags:{},_declare:{},pre:function(a){for(var c=
0,e=a.length;c<e;c+=2)A.each(a[c].split(","),function(e){this._pre.push(e,a[c+1])},this)},tags:function(a){var c=this;A.each(a,function(a,f){/__/.test(f)||(a.name=f);c._tags[f]=a;A.each(a.alias,function(a){c._tags[a]=f})})},declare:function(a){this._declare=a},processing:function(a,c,e,f){"<element>"==c?a.type==a.ELEMENT&&e.call(this,a,f):a.is(c)&&e.call(this,a,f);for(var h=[].concat(a.children);a=h.shift();)this.processing(a,c,e,f)},processingDeclare:function(a,c,e){var f=c.name,h=this._declare[f];
if(h){c="("+Va(a,void 0===c.value?1:c.value,f)+")";var j=h.compile;e=e&&(h.init||h.update);if(!e&&j){var k=[];A.each(j,function(a,c){k.push(["x:else",{"if":c.replace(/\$expr\b/g,"__xd")}]);A.each(a,function(a,c){k.push(["x:attr",{name:c,content:a}])})});a.append(Ua.make("x:dummy",{children:[["x:script","var __xd="+c+";"],["x:if",{test:"false",children:k}]]}))}e&&a.append(Ua.make("x:bind-declare",{data:c,xpath:a.getPath(),name:f}))}},compile:function(a,c){var e={files:[0]},f=[],h,j=this._pre,k=0,p=
j.length;c=A.extend({binds:A.isClient},c);try{h=zb[c.content?"parseString":"parse"](c.content||a,{file:a}).first();for(!h.is("tpl")&&!h.is("template")&&h.exception('root, must be "x:tpl"');k<p;k+=2)this.processing(h,j[k],j[k+1],c.binds);this.compileToMeta(f,e,h);f.unshift(e);f=this.compileToJS(f,c)}catch(l){f=l.message||l.toString(),l.line?f+="\nline: "+l.line+"\nfile: "+l.file:l.stack&&(f+="\n"+l.stack),h="[xtpl.compile.fail] "+f,f=this.compileToJS([e,"tpl",[],"text",h,0,"tpl"],c),A.error(h)}return f},
compileToMeta:function(a,c,e){if(A.isArray(e))A.each(e,function(e){this.compileToMeta(a,c,e)},this);else{var f=this._tags[e.name],h={},j=c.files,k=A.indexOf(j,e.file);f&&e.type==e.ATTR&&(f=0);f&&(f.ns&&!e.ns)&&(f=0);-1==k&&(k=e.file?j.push(e.file):j[j.length-1]);"string"==typeof f&&(f=this._tags[f]);if(e.type==e.TEXT)a.push("text",e.value);else{if(f){f.parent&&!e.parent.is(f.parent)&&e.exception('wrong parent (not "x:'+f.parent+'")');f["short"]&&e.children.length?e.exception("not a short"):!1===f["short"]&&
e.empty?e.exception("short"):!1===f.empty&&(e.closed?e.exception("can not be short"):e.children.length||e.exception("empty"));f.valid&&f.valid(e,e.attrs);if(f.replace){a.push("text",f.replace);return}A.each(f.args,function(a,c){if("function"==typeof a)h[c]=a(e);else if("object"==typeof a)for(var f in a)h[f]=a[f](e);else 0<=a&&(a=c+(a?"":"?")),/xpath/.test(a)?(c=e.getPath(),a="xpath"):c=~a.indexOf("?")?e.attrVal(a=a.substr(0,a.length-1)):e.attr(a),h[a]=c});A.each(f.expr||[],function(a){Va(e,h[a],a)});
A.each(f.vars||[],function(a){if(h[a])try{new Function("var "+h[a])}catch(c){e.exception('"'+a+'" attribute, not valid'+c.toString())}});if(f.skip&&("function"!==typeof f.skip||f.skip(h,e))){this.compileToMeta(a,c,e.children);return}}h._file=k;h._line=e.line;f&&!f.elem?(a.push(f.name,h),this.compileToMeta(a,c,e.children),a.push(0,f.name)):(f?a.push(f.name,h):a.push("text","<"+e.name),A.each(e.attrs,function(f){void 0===h[f.name]&&(f.value?a.push("text"," "+f.name+'="'+f.value+'"'):(e.xattrs||(h.xpath=
e.getPath(),h.getter=e.attrGetter||0,e.xattrs=!0,a.push("attrs",h)),this.compileToMeta(a,c,f.children)))},this),e.xattrs&&a.push(0,"attrs"),f?a.push(f.name,"close"):a.push("text",e["short"]?"/>":">"),this.compileToMeta(a,c,e.children),f?a.push(0,f.name):e["short"]||a.push("text","</"+e.name+">"))}}},compileToJS:function(a,c){var e=0,f=a.length-1,h=this._tags,j,k,l,m,n="",q=[];for(h.__meta(a.shift());e<f;e+=2)if((j=h[l=a[e]?a[e]:a[e+1]])&&(k=j.code))a[e]?(m=a[e+1],"text"!=l&&q.push(m),"function"==
typeof k?n+=k.call(k,m,c.binds)||"":"string"==typeof k?n+=k:k.open&&(n="function"==typeof k.open?n+(k.open.call(k,m,c.binds)||""):n+k.open)):("text"!=l&&(m=q.pop()),k.close&&(n="function"==typeof k.close?n+(k.close.call(k,m,c.binds)||""):n+k.close));return h.__build(n)}};"function"==typeof u?u("Compiler",Wa):module.exports=Wa;var Xa={autofocus:{init:function(a){$(a).focus()}},visible:{compile:{$expr:{style:"display:none;"}},init:function(a,c){this.update(a,c)},update:function(a,c){a.style.display=
c?"":"none"}},"fade-in":{init:function(a,c,e){e&&this.update(a,c)},update:function(a,c){$(a).css("opacity",0).animate({opacity:1},c)}},"fade-out":{init:function(a,c,e){e&&this.update(a,c)},update:function(a,c){$(a).animate({opacity:0},c)}},"dnd-files":{init:function(a,c,e,f){c=[].concat(c);FileAPI.event.dnd(a,function(e){c[1]&&$(a).toggleClass(c[1],e)},function(a){c[0](a);f.$apply()})}},"choose-files":{init:function(a,c){FileAPI.event.on(a,"change",function(){c(FileAPI.getFiles(a))})}}};"function"==
typeof u?u("declare",Xa):module.exports=Xa;var qa=l("./utils"),ka=l("./Buffer"),X=l("./Compiler"),Ya=function(a){var c=J["__"+a],e={};Y[a]&&c&&(Y[a](e),Z.bind(c.node,"__"+a,e),delete c.node)},J={},Y={},ra=l("./declare"),Z={utils:qa,mod:function(a,c){qa.mods[a]=c},decl:function(a,c){ra[a]=c},compile:function(a,c){return X.compile(a,c)},fetch:function(a,c,e){"string"===typeof a&&void 0===J[a]&&(J[a]=X.compile(a,e));return J[a](new ka,c)},bind:function(a,c,e,f){"string"===typeof c&&(void 0===J[c]&&(J[c]=
X.compile(c,f)),c=J[c]);t.time("xtpl.bind");a=new ka.Bind(a,c,ra);a.ctrl=Y;e=e||{};if(c.ctrl)Y[c.ctrl](e);a.setData(e);t.timeEnd("xtpl.bind");return a},ctrl:function(a,c){if(void 0===c)return Y[a];Y[a]=c;Ya(a);return c}};X.pre(l("./pre"));X.tags(l("./tags"));X.declare(ra);ka.$(function(a){a("x\\:tpl").each(function(a,e){var f=e.getAttribute("ctrl"),h=Z.compile(location.href,{content:'<x:tpl context-name="'+(e.getAttribute("context-name")||"ctx")+'">'+e.innerHTML+"</x:tpl>"});f?(J["__"+f]=h,J["__"+
f].node=e,Ya(f)):Z.bind(e,h,{})})});ka.$.fn.xtpl=function(a,c){var e=this[0];e&&Z.bind(e,a,c||{});return this};qa.isClient&&document.createElement("x");"function"==typeof u?u("xtpl",Z):module.exports=Z;window.xtpl=l("xtpl")})();"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{xtpl}xtpl.min");"function"===typeof define&&define.amd&&define("xtpl",[],function(){return window.xtpl||{}});